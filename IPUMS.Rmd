---
title: "IPUMS & R"
author: "Bach Tran"
date: "`r Sys.Date()`"
output: html_document
---

```{r technical setup, include=T, echo = T}
library("ipumsr")
library("dplyr")
library("ggplot2")
library("stringr")
library("purrr")
library("sf")

#html
library("DT")
library("htmltools")
library("shiny")
library("rstudioapi")

#fonts
library("showtext")

#model packages
```

```{r visual setup, include=T, echo = T}
#font
font = font_add_google("Pathway Gothic One", "Pathway Gothic One")
font1 = "Pathway Gothic One"
showtext_auto()

#palette . I will add after I figure out the aesthetic I like

#ggplot. I will add after I figure out the aesthetic I like
```

### Import Data and Codebook <br>

```{r setup, include=T, echo = T}
ddi = read_ipums_ddi("usa_00012.xml")
data = read_ipums_micro(ddi)
```
#### Data citation: Steven Ruggles, Sarah Flood, Matthew Sobek, Daniel Backman, Grace Cooper, Julia A. Rivera Drew, Stephanie Richards, Renae Rodgers, Jonathan Schroeder, and Kari C.W. Williams. IPUMS USA: Version 16.0 [dataset]. Minneapolis, MN: IPUMS, 2025. https://doi.org/10.18128/D010.V16.0 <br>


### On the data subset: _[forthcoming]_ <br>

### Analysis objective: _[forthcoming]_ <br>

### Data Exploration
```{r explore, echo=T}
names(ddi)
ipums_view(ddi,"codebook.html", launch = FALSE)
```
### Data wrangle (I will add more as time progresses)
```{r subset, echo=T}
college_regex = "^[123] yeear(s)? of college$" #define patern to relabel some college
data$EDUCD_level = data$EDUCD %>%
  lbl_collapse(~.val %/% 10)%>%
  lbl_relabel(
    lbl(2,"Less than High School") ~.val> 0 & .val <6,
    lbl(3, "High school") ~.lbl =="Grade 12",
    lbl(4, "Some college") ~str_detect(.lbl, college_regex),
    lbl(5, "College or more") ~.val %in% c(10,11)
  )%>%
  as_factor()
```


##Data Exploration pt.2
```{r wrangle, echo=T}
college_to_advance_degree_graph = data %>%
  group_by(YEAR)%>%
  filter(AGE >=25 & AGE <= 67) #Assuming retirement age is 67 

more_than_four_college_year_to_population_age_25_to_67 = college_to_advance_degree_graph%>% #long name, sorry, but Im open to suggestions for a better naming schemes
  summarise("prop" = 
              sum(EDUCD_level == "College or more") / length(EDUCD_level) ) %>%
  mutate(percent = signif(prop*100, digits = 4))
```

## Education Attainment v. various factors <br>
### Composition of people with more than 4 years of college to population from 25-67 <br>
``` {r overview graph}
ggplot(more_than_four_college_year_to_population_age_25_to_67, aes(YEAR, percent)) +
  geom_point(color = "#011638") +
  geom_line(color = "#011638") +
  ylim(30,40) +
  scale_x_continuous(breaks = 2017:2023) +
  labs(
    x ="Year",
    y = "Percentage with a Bachlor Degree and above",
    title = "Proportion of people with a college degree among the the 25 to 67 years old",
    subtitle = paste0("Data source: ", ddi$ipums_project),
    caption = paste(
      strwrap(ipums_var_desc(ddi, EDUCD), ),
      collapse = "\n")) +
  geom_text(aes(label = paste(percent,"%"), family = font1,vjust = -0.5)) +
  theme(panel.grid.major = element_blank(), #graph element
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = '#FFF8F0'),
        plot.background = element_rect(fill = '#FFF8F0'), 
        axis.line = element_line(colour = "black")) +
  theme(text=element_text(size=20,  family= font1)) #I split the function into two for readability
```
#**_________________________________PLEASE DISREGARD ALL CODE BELLOW THIS LINE (FOR NOW)_________________________________** <br>


#### Composition of people with more than 4 years of college to population from 25-67 
``` {r overview graph 2}
ggplot(more_than_four_college_year_to_population_age_25_to_67, aes(YEAR, prop)) +
  geom_bar(stat = "identity") +
  ylim(0, 0.5) +
  labs(
    title = "proportion of people with a college degree among the the 25 to 67 years old",
    subtitle = paste0("Data source: ", ddi$ipums_project),
    caption = paste(
      strwrap(ipums_var_desc(ddi, EDUCD), 300),
      collapse = "\n"
    ) +
  coord_flip() 
  )

ggplot(college_to_advance_degree_graph, aes(YEAR, sum(EDUCD_level == "College or more"))) +
  geom_line() 

```
